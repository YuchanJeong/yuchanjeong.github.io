



  




<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="dark"
  data-auto-appearance="false"
><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>[Debate-Ducks] Debateroom - Canvas &middot; Yuchan&#39;s hello world!</title>
    <meta name="title" content="[Debate-Ducks] Debateroom - Canvas &middot; Yuchan&#39;s hello world!" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.8a082f81b27f3cb2ee528df0b0bdc39787034cf2cc34d4669fbc9977c929023c.js"
    integrity="sha256-iggvgbJ/PLLuUo3wsL3Dl4cDTPLMNNRmn7yZd8kpAjw="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.b0785c8131a75f72b211435af86269eb2d4b81dda03a8f2cf5ccb1c967747167.css"
    integrity="sha256-sHhcgTGnX3KyEUNa&#43;GJp6y1Lgd2gOo8s9cyxyWd0cWc="
  />
  
    
    
    
  
  
  
    
    
  
  
  
  
    
    <script
      defer
      type="text/javascript"
      id="script-bundle"
      src="/js/main.bundle.min.f29ffdffd9ab4cc95250c3c7196b2d5dae8ee6ef0a4139451073f90183ae7e31.js"
      integrity="sha256-8p/9/9mrTMlSUMPHGWstXa6O5u8KQTlFEHP5AYOufjE="
      data-copy="Copy"
      data-copied="Copied"
    ></script>
  
  
  <meta
    name="description"
    content="
      
        Summary #캔버스에 비디오 및 공유 화면를 포함한 여러 요소들을 그리고 녹화할 수 있게 만듦.
      
    "
  />
  
  
  
  <link rel="canonical" href="https://yuchanjeong.github.io/posts/projects/debate-ducks/6/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:title" content="[Debate-Ducks] Debateroom - Canvas" />
<meta property="og:description" content="Summary #캔버스에 비디오 및 공유 화면를 포함한 여러 요소들을 그리고 녹화할 수 있게 만듦." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yuchanjeong.github.io/posts/projects/debate-ducks/6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-22T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="[Debate-Ducks] Debateroom - Canvas"/>
<meta name="twitter:description" content="Summary #캔버스에 비디오 및 공유 화면를 포함한 여러 요소들을 그리고 녹화할 수 있게 만듦."/>

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "[Debate-Ducks] Debateroom - Canvas",
    "headline": "[Debate-Ducks] Debateroom - Canvas",
    
    "abstract": "Summary #캔버스에 비디오 및 공유 화면를 포함한 여러 요소들을 그리고 녹화할 수 있게 만듦.",
    "inLanguage": "en",
    "url" : "https:\/\/yuchanjeong.github.io\/posts\/projects\/debate-ducks\/6\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2022",
    "dateCreated": "2022-05-22T00:00:00\u002b00:00",
    "datePublished": "2022-05-22T00:00:00\u002b00:00",
    
    "dateModified": "2022-05-22T00:00:00\u002b00:00",
    
    "keywords": ["\\Debate-Ducks","(Devlog)"],
    
    "mainEntityOfPage": "true",
    "wordCount": "738"
  }
  </script>
    
    <script type="application/ld+json">
    {
   "@context": "https://schema.org",
   "@type": "BreadcrumbList",
   "itemListElement": [
     {
       "@type": "ListItem",
       "item": "https://yuchanjeong.github.io/",
       "name": "Yuchan's Hello World!",
       "position": 1
     },
     {
       "@type": "ListItem",
       "item": "https://yuchanjeong.github.io/posts/",
       "name": "Posts",
       "position": 2
     },
     {
       "@type": "ListItem",
       "item": "https://yuchanjeong.github.io/categories/projects/",
       "name": "\u003cProjects\u003e",
       "position": 3
     },
     {
       "@type": "ListItem",
       "name": "[ Debate Ducks] Debateroom Canvas",
       "position": 4
     }
   ]
 }
  </script>

  
  
  
  
  






  
  
  
  
  
  


  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Yuchan&rsquo;s hello world!</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/posts/"
                  title="Posts"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Posts</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/categories/"
                  title="Categories"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/tags/"
                  title="Tags"
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
          
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0">
              <button id="search-button-m0" title="Search (/)">
                <span
                  class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"
                >
                  <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
                </span>
              </button>
            </li>
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        [Debate-Ducks] Debateroom - Canvas
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  
    
  

  

  

  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2022-05-22 00:00:00 &#43;0000 UTC">22 May 2022</time>
    

    
    
  </div>

  
  
    <div class="my-1 flex flex-wrap text-xs leading-relaxed text-neutral-500 dark:text-neutral-400">
      
        
          
            <a
              href="/categories/projects/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >&lt;Projects&gt;</a
            >
          
        
      
        
          
            <a
              href="/tags/%5Cdebate-ducks/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >\Debate-Ducks</a
            >
          
            <a
              href="/tags/devlog/"
              class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
              >(Devlog)</a
            >
          
        
      
    </div>
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
        <div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8">
          <div class="toc pe-5 lg:sticky lg:top-10 print:hidden">
            <details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5">
  <summary
    class="block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden"
  >
    Table of Contents
  </summary>
  <div class="border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#details">Details</a>
      <ul>
        <li><a href="#캔버스-및-비디오-크기">캔버스 및 비디오 크기</a></li>
        <li><a href="#카메라-연결-상태">카메라 연결 상태</a></li>
        <li><a href="#캔버스에-그리기">캔버스에 그리기</a></li>
        <li><a href="#공유-화면-그리기">공유 화면 그리기</a></li>
        <li><a href="#props-타입-정리">Props 타입 정리</a></li>
      </ul>
    </li>
    <li><a href="#problems">Problems</a>
      <ul>
        <li><a href="#pr-커밋-중첩-문제">PR 커밋 중첩 문제</a></li>
        <li><a href="#useref-할당-불가능-문제">useRef 할당 불가능 문제</a></li>
      </ul>
    </li>
    <li><a href="#reflections">Reflections</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <h2 id="summary" class="relative group">Summary <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#summary" aria-label="Anchor">#</a></span></h2><p>캔버스에 비디오 및 공유 화면를 포함한 여러 요소들을 그리고 녹화할 수 있게 만듦.</p>
<img width="800px" alt="record" src="https://user-images.githubusercontent.com/84524514/170090866-8df029df-795f-4632-a3fd-ad033abe965c.gif" />
<h2 id="details" class="relative group">Details <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#details" aria-label="Anchor">#</a></span></h2><h3 id="캔버스-및-비디오-크기" class="relative group">캔버스 및 비디오 크기 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%ec%ba%94%eb%b2%84%ec%8a%a4-%eb%b0%8f-%eb%b9%84%eb%94%94%ec%98%a4-%ed%81%ac%ea%b8%b0" aria-label="Anchor">#</a></span></h3><p>이전 프로젝트에서 동일한 동영상 퀄리티를 위해 캔버스에 고정 크기를 사용했다. 그래서 화면을 줄이거나 모바일에서 보게 되면 캔버스가 잘리는 문제가 있었다. 이번에는 이런 문제를 해결하고 싶었다. 그래서 스타일(임시로 인라인 스타일 사용)로 보여지는 캔버스의 크기를 바꾼 다음 녹화 테스트를 하자 보여지는 캔버스의 크기와는 상관 없이 캔버스의 고정 크기에 맞게 녹화되었다.</p>
<p>(이전에는 Canvas 요소를 도입할 계획이 있던게 아니라 녹화를 위해 급하게 도입했다. 시간 부족 상태에서 녹화가 잘 진행되자 추가적인 개선 사항을 알아보지 않고 바로 다음 단계로 넘어갔다. 🙏🙏🙏)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">canvas</span>
</span></span><span class="line"><span class="cl">  <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">canvasRef</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="na">width</span><span class="o">=</span><span class="s">&#34;1280px&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">=</span><span class="s">&#34;720px&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">style</span><span class="o">=</span><span class="p">{{</span> <span class="nx">border</span><span class="o">:</span> <span class="s2">&#34;2px solid red&#34;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="s2">&#34;100vw&#34;</span> <span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>이전 프로젝트에서 비디오는 캔버스 내부의 <code>drawImage</code>에서 크기를 조정해서 사용했다. 그래서 사용자 카메라의 종류에 따라 화면이 늘어나는 문제가 있었다. 하지만 다른 팀원들의 비디오를 연결해 봤을 때 크게 늘어나지 않았고, 시간도 부족하여 그냥 넘어 갔었다. 이번에는 사용자의 비디오를 획득할 때 애초에 고정된 크기에 맞게 받아서 늘어남 문제를 원천 차단하였다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">video</span><span class="o">:</span> <span class="p">{</span> <span class="nx">facingMode</span><span class="o">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span> <span class="nx">width</span>: <span class="kt">500</span><span class="p">,</span> <span class="nx">height</span>: <span class="kt">500</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nx">audio</span><span class="o">:</span> <span class="p">{</span> <span class="nx">echoCancellation</span>: <span class="kt">true</span><span class="p">,</span> <span class="nx">noiseSuppression</span>: <span class="kt">true</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span></code></pre></div><p>이전 프로젝트에서는 화면 가운데 보이지 않는 비디오를 고정하는 방식으로 뷰 바깥의 요소를 캔버스가 그리지 못하는 문제를 해결했었는데 이번에는 <code>sticky</code>를 활용해 좀 더 간단히 해결하였다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">video</span>
</span></span><span class="line"><span class="cl">  <span class="na">ref</span><span class="o">=</span><span class="p">{</span><span class="nx">videoRef</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="na">muted</span>
</span></span><span class="line"><span class="cl">  <span class="na">autoPlay</span>
</span></span><span class="line"><span class="cl">  <span class="na">playsInline</span>
</span></span><span class="line"><span class="cl">  <span class="na">width</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="na">height</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="na">style</span><span class="o">=</span><span class="p">{{</span> <span class="nx">position</span><span class="o">:</span> <span class="s2">&#34;sticky&#34;</span><span class="p">,</span> <span class="nx">top</span>: <span class="kt">0</span> <span class="p">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;&lt;/</span><span class="nt">video</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="카메라-연결-상태" class="relative group">카메라 연결 상태 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%ec%b9%b4%eb%a9%94%eb%9d%bc-%ec%97%b0%ea%b2%b0-%ec%83%81%ed%83%9c" aria-label="Anchor">#</a></span></h3><p>이전 프로젝트에서는 사용자의 카메라가 꺼지면 <code>.enable=false</code> 상태의 검은 화면만 보였다. 이번에는 소켓을 통해 카메라 on/off 여부와 화면공유 on/off 여부를 전달하고, 현재의 연결 상태 및 진행 상태를 고려하여 각각 다른 화면이 보이게 했다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">peer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">socket</span><span class="o">?</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&#34;peerVideo&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">debateId</span><span class="p">,</span> <span class="nx">isVideoOn</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">socket</span><span class="o">?</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&#34;peerScreen&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">debateId</span><span class="p">,</span> <span class="nx">isPeerScreenOn</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="p">[</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">peer</span><span class="p">,</span> <span class="nx">debateId</span><span class="p">,</span> <span class="nx">isVideoOn</span><span class="p">,</span> <span class="nx">isPeerScreenOn</span><span class="p">]);</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">drawText</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">canvasRef</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;#F8FBFD&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;bold 32px san-serif&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">peer</span> <span class="o">?</span> <span class="s2">&#34;Camera Off&#34;</span> <span class="o">:</span> <span class="nx">isPros</span> <span class="o">?</span> <span class="s2">&#34;Camera Off&#34;</span> <span class="o">:</span> <span class="s2">&#34;Not connected&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="mi">300</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="mi">380</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></div><img width="800" alt="Not Connected" src="https://user-images.githubusercontent.com/84524514/170036376-5b4fd654-e154-481c-beca-c0acff95b5be.png">
<img width="800" alt="Camera Off" src="https://user-images.githubusercontent.com/84524514/170036312-150b2598-7c4a-47c6-b9b9-e1ac50f1d5a1.png">
<h3 id="캔버스에-그리기" class="relative group">캔버스에 그리기 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%ec%ba%94%eb%b2%84%ec%8a%a4%ec%97%90-%ea%b7%b8%eb%a6%ac%ea%b8%b0" aria-label="Anchor">#</a></span></h3><p>이전 프로젝트에서는 사용자의 비디오를 그리는 함수, 찬성 측 화면 공유 함수 그리고 반대 측 화면 공유로 함수로 나눠서 작성했었다. 처음에는 요소별로 그리는 함수를 만들어 조건을 걸었지만 한번 interval이 등록된 함수를 삭제하지 않으면 중첩으로 그려지는 문제가 발생하기 때문이었다.</p>
<p>이번에는 interval을 중지하고 다시 시작하는 부분은 <code>useEffect()</code>의 <code>dependency</code>로 처리하고, 그리기 함수 내부에서 조건에 따라 다른 화면을 그리게 처리하여 가독성과 유지보수의 편리성을 늘렸다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">drawStop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">drawStart</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="nx">drawStart</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">drawStop</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">peer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isVideoOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isPeerVideoOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isScreenOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isPeerScreenOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span></code></pre></div><p>또한 캔버스에 그리는 과정도 종류(사각형, 텍스트, 비디오)별로 함수를 작성한 다음 파라미터를 이용해 원하는 것을 그릴 수 있게 만들어 가독성과 유지 보수의 편리성을 늘렸다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">drawSquare</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">canvasRef</span>: <span class="kt">MutableRefObject</span><span class="p">&lt;</span><span class="nt">HTMLCanvasElement</span> <span class="err">|</span> <span class="na">null</span><span class="p">&gt;,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">color</span>: <span class="kt">string</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dx</span>: <span class="kt">number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dy</span>: <span class="kt">number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">w</span>: <span class="kt">number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">h</span>: <span class="kt">number</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvasRef</span><span class="p">.</span><span class="nx">current</span><span class="o">?</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&#34;2d&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">dx</span><span class="p">,</span> <span class="nx">dy</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><h3 id="공유-화면-그리기" class="relative group">공유 화면 그리기 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#%ea%b3%b5%ec%9c%a0-%ed%99%94%eb%a9%b4-%ea%b7%b8%eb%a6%ac%ea%b8%b0" aria-label="Anchor">#</a></span></h3><p>자신의 차례일 때만 공유 화면이 크게 그려지며, 그려지는 공유 화면은 공유 대상의 비율에 맞춰서 화면에 그려지게 만들었다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// prosTurn: &#34;none&#34; | &#34;true&#34; | &#34;false&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="nx">isScreenOn</span> <span class="o">&amp;&amp;</span> <span class="nb">String</span><span class="p">(</span><span class="nx">isPros</span><span class="p">)</span> <span class="o">===</span> <span class="nx">prosTurn</span><span class="p">)</span> <span class="p">{...}</span>
</span></span></code></pre></div><img width="800px" alt="screen share" src="https://user-images.githubusercontent.com/84524514/170199896-1c5ff99a-16f4-4596-a8db-1cad6027fc40.gif" >
<h3 id="props-타입-정리" class="relative group">Props 타입 정리 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#props-%ed%83%80%ec%9e%85-%ec%a0%95%eb%a6%ac" aria-label="Anchor">#</a></span></h3><p>Props를 넘길 때마다 Props의 타입을 하나하나 작성해 줘야 해서 귀찮았다. Props의 타입을 <code>interface</code>로 미리 작성해두고 <code>Pick</code>으로 뽑아서 사용하니 편리하고 시간도 절약되었다.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-tsx" data-lang="tsx"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">Buttons</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">peer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">streamRef</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">videoRef</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isAudioOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setIsAudioOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">isVideoOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setIsVideoOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setIsScreenOn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="o">:</span> <span class="nx">Pick</span><span class="o">&lt;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">IDebateroomProps</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;peer&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;streamRef&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;videoRef&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;isAudioOn&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;setIsAudioOn&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;isVideoOn&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;setIsVideoOn&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">|</span> <span class="s2">&#34;setIsScreenOn&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span><span class="p">)</span> <span class="p">{...}</span>
</span></span></code></pre></div><p>Ps. 색상도 따로 객체 형태로 만들어 유지 보수의 편리성을 높혔다.</p>
<h2 id="problems" class="relative group">Problems <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#problems" aria-label="Anchor">#</a></span></h2><h3 id="pr-커밋-중첩-문제" class="relative group">PR 커밋 중첩 문제 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#pr-%ec%bb%a4%eb%b0%8b-%ec%a4%91%ec%b2%a9-%eb%ac%b8%ec%a0%9c" aria-label="Anchor">#</a></span></h3><p># 문제</p>
<p>PR이 쌓이게 되면 커밋과 변경된 파일이 중첩되는 문제가 있었다. 바로바로 리뷰 후 Merge를 하면 문제가 발생하지 않지만 현실적으로는 쉽지 않다. (bcs 주말, 새벽 PR 등) 또 중첩이 될 경우 앞의 PR은 반려하고 뒤의 PR만 Merge 하는 방법도 있지만, PR은 변경 사항을 쉽게 파악할 수 있어야 하기 때문에 너무 많아지거나 다양한 기능이 있는 건 지양해야 한다.</p>
<img width="800" alt="PR1" src="https://user-images.githubusercontent.com/84524514/169761520-8fd9e5ca-c01c-4969-8740-ef430427fe5e.png">
<img width="800" alt="PR2" src="https://user-images.githubusercontent.com/84524514/169761498-ffc5d25c-af69-49a6-9ccc-a45db6ae82f9.png">
<p># 해결</p>
<p>앞의 PR을 Merge 한 뒤, 다음 PR을 Merge 하기 전에 Edit을 통해 브랜치를 재설정 해주면 PR이 중첩되지 않고 해당 PR의 변경 사항만 기록된다.</p>
<img width="800" alt="PR3" src="https://user-images.githubusercontent.com/84524514/169777664-3d19858d-7d0d-48d8-bec9-5aa80f085bb3.png">
<img width="500" alt="PR4" src="https://user-images.githubusercontent.com/84524514/169777698-8d8e8245-f2f7-4886-b1e5-fd3c01762fa0.png">
<h3 id="useref-할당-불가능-문제" class="relative group">useRef 할당 불가능 문제 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#useref-%ed%95%a0%eb%8b%b9-%eb%b6%88%ea%b0%80%eb%8a%a5-%eb%ac%b8%ec%a0%9c" aria-label="Anchor">#</a></span></h3><p>캔버스에 사용자의 미디어와 공유 화면을 각각 그리기 위해 <code>useInterval Hook</code> 작성 중 <code>Cannot assign to 'current' because it is a read-only property.</code> 에러가 발생하였다. 이유는 초깃값으로 null을 지닐 때 제네릭에 null을 포함하지 않으면 변경할 수 없는 객체를 생성하기 때문이다.</p>
<p>Ref. <a href="https://bobbyhadz.com/blog/react-cannot-assign-to-current-because-read-only-property" target="_blank" rel="noreferrer">(useRef) Cannot assign to &lsquo;current&rsquo; because it is read-only property</a></p>
<h2 id="reflections" class="relative group">Reflections <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#reflections" aria-label="Anchor">#</a></span></h2><p>아직 많이 부족하지만 중복 작성되는 요소들을 최대한 공통으로 묶어서 빼는 노력을 통해 코드의 가독성과 유지 보수의 편리성이 많이 늘어났다. 또한 만나는 이슈나 개발과정의 기록을 통해 코드를 이전보다 더 확실하게 이해하게 됬다. 특히 이전에는 내가 작성한 코드를 팀원에게 설명해 줄 때 많은 어려움을 겪었는데, 기록을 하면서 코드를 인간의 언어로 설명하는 과정을 연습할 수 있게 되었고 (이전에는 인간의 언어를 코드로 작성하는 부분만 집중적으로 함), 이제는 팀원들에게 내 코드를 설명하는데 큰 어려움이 없다.</p>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
    <div class="place-self-center">
      
      
      <div class="text-2xl sm:text-lg">
</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="/posts/projects/debate-ducks/5/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >[Debate-Ducks] Debateroom - Stream</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-05-21 00:00:00 &#43;0000 UTC">21 May 2022</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/posts/studies/react/redux/redux-toolkit-next.js-ts/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >[Redux] Redux-toolkit in Next.js and TypeScript</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2022-05-23 00:00:00 &#43;0000 UTC">23 May 2022</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
        
          
        
      
    </footer>
  </article>

      </main>
      
        <div
          class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"
          id="to-top"
          hidden="true"
        >
          <a
            href="#the-top"
            class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      <footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            © 2021 Yuchan&rsquo;s hello world!
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
        <div
          class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        >
          <button id="appearance-switcher-0" type="button" aria-label="appearance switcher">
            <div
              class="flex h-12 w-12 items-center justify-center dark:hidden"
              title="Switch to dark appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>
</span>
            </div>
            <div
              class="hidden h-12 w-12 items-center justify-center dark:flex"
              title="Switch to light appearance"
            >
              <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>
</span>
            </div>
          </button>
        </div>
      
    </div>
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://yuchanjeong.github.io/"
>
  <div
    id="search-modal"
    class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex flex-none items-center justify-between px-2">
      <form class="flex min-w-0 flex-auto items-center">
        <div class="flex h-8 w-8 items-center justify-center text-neutral-400">
          <span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span>
        </div>
        <input
          type="search"
          id="search-query"
          class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        <span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>
</span>
      </button>
    </header>
    <section class="flex-auto overflow-auto px-2">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
